apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "aegis-db.fullname" . }}-config
  labels:
    {{- include "aegis-db.labels" . | nindent 4 }}
data:
  aegis.toml: |
    # Aegis Database Configuration
    # Generated by Helm

    [server]
    http_port = {{ .Values.server.httpPort }}
    grpc_port = {{ .Values.server.grpcPort }}
    metrics_port = {{ .Values.server.metricsPort }}

    [cluster]
    name = "{{ .Values.cluster.name }}"
    replication_factor = {{ .Values.cluster.replicationFactor }}
    auto_failover = {{ .Values.cluster.autoFailover }}

    [raft]
    port = {{ .Values.server.raftPort }}
    election_timeout_min_ms = 150
    election_timeout_max_ms = 300
    heartbeat_interval_ms = 50

    [storage]
    data_dir = "/data"
    wal_dir = "/wal"

    [memory]
    buffer_pool_size = "{{ .Values.memory.bufferPoolSize }}"
    query_memory_limit = "{{ .Values.memory.queryMemoryLimit }}"
    cache_size = "{{ .Values.memory.cacheSize }}"

    [logging]
    level = "{{ .Values.logging.level }}"
    format = "{{ .Values.logging.format }}"
    request_logging = {{ .Values.logging.requestLogging }}

    [engine.sql]
    enabled = {{ .Values.engine.sql.enabled }}
    max_connections = {{ .Values.engine.sql.maxConnections }}
    query_timeout = "{{ .Values.engine.sql.queryTimeout }}"

    [engine.timeseries]
    enabled = {{ .Values.engine.timeseries.enabled }}
    retention_days = {{ .Values.engine.timeseries.retentionDays }}
    downsample_interval = "{{ .Values.engine.timeseries.downsampleInterval }}"

    [engine.document]
    enabled = {{ .Values.engine.document.enabled }}
    max_document_size = "{{ .Values.engine.document.maxDocumentSize }}"

    [engine.streaming]
    enabled = {{ .Values.engine.streaming.enabled }}
    max_subscribers = {{ .Values.engine.streaming.maxSubscribers }}
    buffer_size = {{ .Values.engine.streaming.bufferSize }}

    [security]
    tls_enabled = {{ .Values.security.tls.enabled }}
    auth_enabled = {{ .Values.security.auth.enabled }}

    [monitoring]
    prometheus_enabled = {{ .Values.monitoring.prometheus.enabled }}
